<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Team Analytics – No-CDN Build</title>
<style>
  :root{--bg:#0c1117;--panel:#0f1621;--muted:#9aa4b2;--text:#e6edf3;--brand:#4aa9ff;--border:#1e2633;--good:#2dd4bf;--bad:#f43f5e;--radius:14px}
  *{box-sizing:border-box} body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,#0b1220,transparent),radial-gradient(900px 500px at 100% 0%,#071422,transparent),var(--bg);color:var(--text);font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1200px;margin:28px auto;padding:0 16px}
  .header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px}
  .title{font-size:28px;font-weight:700;letter-spacing:.2px;display:flex;gap:10px;align-items:center}
  .pill{background:#0b1420;border:1px solid var(--border);padding:4px 10px;border-radius:999px;color:#cbd5e1;font-size:12px}
  select{appearance:none;background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 14px;min-width:220px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:16px}
  .card h3{margin:0 0 12px;font-size:16px}
  .snapshot{display:grid;gap:12px;grid-template-columns:repeat(6,minmax(160px,1fr))}
  @media (max-width:1100px){.snapshot{grid-template-columns:repeat(3,minmax(160px,1fr))}}
  @media (max-width:640px){.snapshot{grid-template-columns:repeat(2,minmax(140px,1fr))}}
  .stat{border:1px solid var(--border);border-radius:12px;padding:12px;min-height:84px;display:flex;flex-direction:column;gap:6px;background:rgba(255,255,255,.01)}
  .stat label{color:var(--muted);font-size:12px;display:flex;align-items:center;gap:6px}
  .stat .value{font-size:18px;font-weight:700}
  .info{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;border:1px solid #2a3750;color:#9fb3c8;font-size:11px;cursor:default}
  .note{color:#95a3b8;font-size:12px;margin-top:10px}
  .grid{display:grid;gap:16px}
  @media (min-width:880px){.grid-2{grid-template-columns:1fr 1fr}}
  .error{background:#2a1320;border:1px solid #5c1e34;color:#ffd1da;padding:10px 12px;border-radius:10px;margin-bottom:12px;display:none;white-space:pre-wrap}
  /* SVG containers */
  .svgbox{width:100%; height:380px; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,.01); display:flex; align-items:center; justify-content:center}
  .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:#a9b4c2;margin-top:8px}
  .legend .dot{width:10px;height:10px;border-radius:50%;background:#4aa9ff}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="title">
      <span>Team Analytics</span>
      <span class="pill" id="rankPill">#—</span>
      <span class="pill" id="teamPill">—</span>
    </div>
    <select id="teamSelect" aria-label="Select team"></select>
  </div>

  <div id="errorBox" class="error"></div>

  <div class="card">
    <h3>Snapshot</h3>
    <div class="snapshot">
      <div class="stat"><label>Points per Play (Offense) <span class="info" title="Average points added by the offense on each play.">i</span></label><div class="value" id="offPPA">—</div></div>
      <div class="stat"><label>Success Rate (Offense) <span class="info" title="Share of plays that keep the drive on schedule (down & distance).">i</span></label><div class="value" id="offSR">—</div></div>
      <div class="stat"><label>Explosiveness (Offense) <span class="info" title="How big the gains are when a play hits.">i</span></label><div class="value" id="offExp">—</div></div>
      <div class="stat"><label>Yards per Play (Offense)</label><div class="value" id="offYPP">—</div></div>

      <div class="stat"><label>Points per Play Allowed (Defense)</label><div class="value" id="defPPA">—</div></div>
      <div class="stat"><label>Success Rate Allowed (Defense)</label><div class="value" id="defSR">—</div></div>
      <div class="stat"><label>Explosiveness Allowed (Defense)</label><div class="value" id="defExp">—</div></div>
      <div class="stat"><label>Yards per Play Allowed (Defense)</label><div class="value" id="defYPP">—</div></div>

      <div class="stat"><label>Power Index</label><div class="value" id="fpiVal">—</div></div>
      <div class="stat"><label>Offensive Plays</label><div class="value" id="playsOff">—</div></div>
      <div class="stat"><label>Defensive Plays Faced</label><div class="value" id="playsDef">—</div></div>
      <div class="stat"><label>Games Played</label><div class="value" id="games">—</div></div>
    </div>
    <div class="note">All values are per play unless noted. “Allowed” = what your defense gave up to opponents.</div>
  </div>

  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <h3>Offensive Profile (Spider)</h3>
      <div id="radarBox" class="svgbox"></div>
      <div class="legend"><span class="dot"></span>Offense (normalized within the selected dataset)</div>
    </div>
    <div class="card">
      <h3>Efficiency Comparison (Bars)</h3>
      <div id="barsBox" class="svgbox"></div>
      <div class="legend"><span class="dot"></span>Selected team</div>
    </div>
  </div>
</div>

<!-- PASTE YOUR RAW JSON ARRAY BETWEEN THESE TAGS (comments/trailing commas are OK) -->
<script id="teams-json" type="text/plain">
[
  {
    "team":"Alabama","year":2025,
    "simple":{
      "overall__games":5,
      "overall__netpassingyards":1627,
      "overall__rushingyards":634,
      "overall__passattempts":176,
      "overall__rushattempts":163,
      "overall__netpassingyardsopponent":652,
      "overall__rushingyardsopponent":778
    },
    "advanced":{
      "offense":{"plays":339,"ppa":0.37535891410422856,"successRate":0.471976401179941,"explosiveness":1.398429456846684},
      "defense":{"plays":272,"ppa":0.12060085388961003,"successRate":0.39705882352941174,"explosiveness":1.2869135990231348}
    },
    "fpi":{"fpi":23.452}
  }
  // … add more teams here …
]
</script>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const err = $("errorBox");
  const RAW = $("teams-json").textContent;

  // ---------- Utils ----------
  const fmt = (n, d=3) => (n == null || isNaN(n)) ? "—" : Number(n).toFixed(d);
  const pct = n => (n == null || isNaN(n)) ? "—" : (n*100).toFixed(1) + "%";
  function sanitizeJSON(text){
    return text
      .replace(/\/\*[\s\S]*?\*\//g, "")
      .replace(/(^|[^:])\/\/.*$/gm, "$1")
      .replace(/,\s*([}\]])/g, "$1")
      .trim();
  }
  function safeParse(text){
    const clean = sanitizeJSON(text);
    try { return JSON.parse(clean); }
    catch(e){
      err.style.display="block";
      err.textContent = "JSON parse error: " + e.message + "\n\nFirst 300 chars of cleaned payload:\n" + clean.slice(0,300);
      return [];
    }
  }
  function getTotalYards(simple){
    const ty = simple?.overall__totalyards;
    const pass = simple?.overall__netpassingyards;
    const rush = simple?.overall__rushingyards ?? simple?.overall__netrushingyards;
    if (typeof ty === "number") return ty;
    if (typeof pass === "number" && typeof rush === "number") return pass + rush;
    return null;
  }
  function getTotalYardsOpp(simple){
    const ty = simple?.overall__totalyardsopponent;
    const pass = simple?.overall__netpassingyardsopponent;
    const rush = simple?.overall__rushingyardsopponent ?? simple?.overall__netrushingyardsopponent;
    if (typeof ty === "number") return ty;
    if (typeof pass === "number" && typeof rush === "number") return pass + rush;
    return null;
  }
  function getPlaysOff(t){
    const p = t?.advanced?.offense?.plays;
    if (typeof p === "number" && p>0) return p;
    const pa = t?.simple?.overall__passattempts;
    const ra = t?.simple?.overall__rushattempts;
    if (typeof pa === "number" && typeof ra === "number") return pa + ra;
    return null;
  }
  function getPlaysDef(t){
    const p = t?.advanced?.defense?.plays;
    if (typeof p === "number" && p>0) return p;
    const pa = t?.simple?.overall__passattemptsopponent;
    const ra = t?.simple?.overall__rushattemptsopponent;
    if (typeof pa === "number" && typeof ra === "number") return pa + ra;
    return null;
  }

  // ---------- Data ----------
  const TEAMS = safeParse(RAW);
  if (!TEAMS.length){
    err.style.display="block";
    err.textContent = (err.textContent ? err.textContent + "\n\n" : "") + "No teams found. Paste a JSON array in the <script id=\"teams-json\"> block.";
  }

  // Build select
  const select = $("teamSelect");
  TEAMS.forEach(t => {
    const opt=document.createElement("option");
    opt.value=t.team; opt.textContent=t.team;
    select.appendChild(opt);
  });
  if (TEAMS[0]) select.value = TEAMS[0].team;

  // Precompute maxima for normalization
  const MAX = TEAMS.reduce((m,t)=>{
    const off=t?.advanced?.offense||{};
    const ypp=(getTotalYards(t.simple)??0)/((getPlaysOff(t)??1));
    m.ppa=Math.max(m.ppa, off.ppa??0);
    m.sr=Math.max(m.sr, off.successRate??0);
    m.exp=Math.max(m.exp, off.explosiveness??0);
    m.ypp=Math.max(m.ypp, ypp);
    return m;
  },{ppa:0,sr:0,exp:0,ypp:0});

  // ---------- SVG helpers ----------
  function el(name, attrs={}, children=[]){
    const n=document.createElementNS("http://www.w3.org/2000/svg",name);
    Object.entries(attrs).forEach(([k,v])=> n.setAttribute(k,v));
    children.forEach(c=> n.appendChild(c));
    return n;
  }
  function clear(node){ while(node.firstChild) node.removeChild(node.firstChild); }

  // Simple bar chart
  function renderBars(node, labels, values){
    clear(node);
    const w = node.clientWidth, h = node.clientHeight;
    const pad = {l:60, r:16, t:20, b:30};
    const svg = el("svg",{width:w, height:h, viewBox:`0 0 ${w} ${h}`});
    const gw = w - pad.l - pad.r; const gh = h - pad.t - pad.b;
    const max = Math.max(0.001, ...values.map(v=>Math.abs(v||0)));

    // axes
    svg.appendChild(el("rect",{x:pad.l,y:pad.t,width:gw,height:gh,fill:"none",stroke:"#223045"}));

    const barW = gw / labels.length * 0.6;
    labels.forEach((lab,i)=>{
      const x = pad.l + (gw/labels.length)*i + (gw/labels.length - barW)/2;
      const v = values[i] ?? 0;
      const vh = (v/max) * (gh*0.9);
      const y = pad.t + gh - vh;
      svg.appendChild(el("rect",{x:x,y:y,width:barW,height:vh,fill:"#4aa9ff"}));
      // value
      svg.appendChild(el("text",{x:x+barW/2,y:y-6,fill:"#cfe3ff","text-anchor":"middle","font-size":"11"},[document.createTextNode(v.toFixed(3))]));
      // label
      const tl = el("text",{x:x+barW/2,y:pad.t+gh+14,fill:"#a9b4c2","text-anchor":"middle","font-size":"11"},[document.createTextNode(lab)]);
      svg.appendChild(tl);
    });
    node.appendChild(svg);
  }

  // Simple spider/radar
  function renderSpider(node, labels, values){ // values are 0..1
    clear(node);
    const w = node.clientWidth, h=node.clientHeight;
    const cx=w/2, cy=h/2, r=Math.min(w,h)/2 - 28, rings=4;
    const svg = el("svg",{width:w,height:h,viewBox:`0 0 ${w} ${h}`});

    // grid rings + spokes
    for(let k=1;k<=rings;k++){
      const rr = (r/rings)*k;
      const poly = [];
      for(let i=0;i<labels.length;i++){
        const a = (Math.PI*2/labels.length)*i - Math.PI/2;
        poly.push(`${cx + rr*Math.cos(a)},${cy + rr*Math.sin(a)}`);
      }
      svg.appendChild(el("polygon",{points:poly.join(" "),fill:"none",stroke:"#223045"}));
    }
    for(let i=0;i<labels.length;i++){
      const a = (Math.PI*2/labels.length)*i - Math.PI/2;
      svg.appendChild(el("line",{x1:cx,y1:cy,x2:cx+r*Math.cos(a),y2:cy+r*Math.sin(a),stroke:"#223045"}));
      // labels
      const lx = cx + (r+14)*Math.cos(a), ly = cy + (r+14)*Math.sin(a);
      svg.appendChild(el("text",{x:lx,y:ly,fill:"#a9b4c2","font-size":"11","text-anchor": Math.cos(a)>0.1?"start":(Math.cos(a)<-0.1?"end":"middle"),"dominant-baseline":"middle"},[document.createTextNode(labels[i])]));
    }

    // data polygon
    const pts = values.map((v,i)=>{
      const a=(Math.PI*2/values.length)*i - Math.PI/2;
      const rr = r * Math.max(0, Math.min(1, v));
      return `${cx + rr*Math.cos(a)},${cy + rr*Math.sin(a)}`;
    }).join(" ");
    svg.appendChild(el("polygon",{points:pts,fill:"rgba(74,169,255,0.18)",stroke:"rgba(74,169,255,0.95)","stroke-width":"2"}));
    node.appendChild(svg);
  }

  // ---------- UI update ----------
  function update(teamName){
    const t = TEAMS.find(x=>x.team===teamName) || TEAMS[0];
    if(!t) return;

    const off=t?.advanced?.offense||{};
    const def=t?.advanced?.defense||{};
    const offPlays=getPlaysOff(t)??0;
    const defPlays=getPlaysDef(t)??0;
    const offTY=getTotalYards(t.simple);
    const defTY=getTotalYardsOpp(t.simple);
    const offYPP = offTY!=null && offPlays>0 ? offTY/offPlays : null;
    const defYPP = defTY!=null && defPlays>0 ? defTY/defPlays : null;

    $("teamPill").textContent = t.team ?? "—";
    $("rankPill").textContent = "#—";

    $("offPPA").textContent = fmt(off.ppa);
    $("offSR").textContent  = pct(off.successRate);
    $("offExp").textContent = fmt(off.explosiveness,2);
    $("offYPP").textContent = fmt(offYPP,2);

    $("defPPA").textContent = fmt(def.ppa);
    $("defSR").textContent  = pct(def.successRate);
    $("defExp").textContent = fmt(def.explosiveness,2);
    $("defYPP").textContent = fmt(defYPP,2);

    $("fpiVal").textContent = fmt(t?.fpi?.fpi,3);
    $("playsOff").textContent = offPlays || "—";
    $("playsDef").textContent = defPlays || "—";
    $("games").textContent = t?.simple?.overall__games ?? "—";

    // Spider (normalized)
    const yppNorm = Math.min(1,(offYPP ?? 0)/(MAX.ypp||1));
    renderSpider($("radarBox"),
      ["Points/Play","Success Rate","Explosiveness","Yards/Play"],
      [
        Math.min(1,(off.ppa ?? 0)/(MAX.ppa||1)),
        Math.min(1,(off.successRate ?? 0)/(MAX.sr||1)),
        Math.min(1,(off.explosiveness ?? 0)/(MAX.exp||1)),
        yppNorm
      ]
    );

    // Bars (raw values)
    renderBars($("barsBox"),
      ["Pts/Play (Off)","Pts/Play Allowed","Success (Off)","Success Allowed","Yds/Play (Off)","Yds/Play Allowed"],
      [off.ppa ?? 0, def.ppa ?? 0, off.successRate ?? 0, def.successRate ?? 0, offYPP ?? 0, defYPP ?? 0]
    );
  }

  if (TEAMS.length){
    update(select.value || TEAMS[0].team);
    select.addEventListener("change", e=> update(e.target.value));
  }
})();
</script>
</body>
</html>
