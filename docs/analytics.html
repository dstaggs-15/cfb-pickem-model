<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CFB Analytics Dashboard</title>
<style>
  :root{
    --bg:#090f17;--panel:#0f1724;--muted:#9fb0c5;--text:#ebf1f7;
    --border:#1d2837;--brand:#4aa9ff;--accent:#9b59ff;--good:#22c55e;--bad:#ef4444;
    --radius:16px;--shadow:0 8px 30px rgba(0,0,0,.35)
  }
  *{box-sizing:border-box}
  body{margin:0;background:
    radial-gradient(1200px 600px at 20% -10%,#0c1630,transparent),
    radial-gradient(900px 500px at 100% 0%,#081628,transparent),
    var(--bg);
    color:var(--text);font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1250px;margin:88px auto 28px;padding:0 16px}

  /* Sticky top bar with team chips */
  .mast{position:fixed;top:0;left:0;right:0;backdrop-filter:blur(10px);
    background:linear-gradient(180deg,rgba(13,23,36,.85),rgba(13,23,36,.55));
    border-bottom:1px solid var(--border);z-index:20}
  .mast-inner{max-width:1250px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .brand{font-weight:700;letter-spacing:.2px}
  .chip{display:flex;align-items:center;gap:8px;border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03)}
  .dot{width:10px;height:10px;border-radius:50%}
  .dot.a{background:var(--brand)}.dot.b{background:var(--accent)}
  .sep{opacity:.5}

  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)),var(--panel);
    border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .toolbar{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
  .toolbar > div{display:flex;flex-direction:column;gap:6px}
  select,input,button{appearance:none;background:rgba(255,255,255,.035);border:1px solid var(--border);color:var(--text);border-radius:12px;padding:10px 12px}
  button{cursor:pointer}

  .grid{display:grid;gap:16px}
  .grid-2{grid-template-columns:1fr 1fr}
  @media (max-width:1000px){.grid-2{grid-template-columns:1fr}}

  .error{background:#2a1320;border:1px solid #5c1e34;color:#ffd1da;padding:10px 12px;border-radius:10px;margin:10px 0;white-space:pre-wrap;display:none}
  .info{background:#0f2233;border:1px solid #1d3e56;color:#c9f1ff;padding:10px 12px;border-radius:12px;margin-top:8px}

  .svgbox{width:100%; height:360px; border:1px dashed var(--border); border-radius:14px;
    background:rgba(255,255,255,.02); display:flex; align-items:center; justify-content:center}

  /* Snapshot cards now show A and B values with labels */
  .snapgrid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(240px,1fr))}
  @media (max-width:980px){.snapgrid{grid-template-columns:1fr}}
  .stat{border:1px solid var(--border);border-radius:14px;padding:12px;background:rgba(255,255,255,.02);min-height:84px}
  .stat>label{font-size:12px;color:var(--muted);display:block;margin-bottom:8px}
  .pair{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .val{display:flex;flex-direction:column;gap:2px}
  .who{display:flex;align-items:center;gap:8px;color:#a9b4c2;font-size:11px}
  .v{font-weight:800;font-size:20px}
  .fade{opacity:.55}

  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid var(--border);padding:10px;text-align:left;vertical-align:top}
  th{color:#c8d2e0;font-weight:700}
  .advA{color:var(--brand);font-weight:700}
  .advB{color:var(--accent);font-weight:700}
</style>
</head>
<body>

<!-- Sticky header with explicit labels -->
<div class="mast">
  <div class="mast-inner">
    <div class="brand">Team Analytics</div>
    <span class="sep">•</span>
    <div id="mastYear" class="chip">Season <strong style="margin-left:6px" id="mastYearTxt"></strong></div>
    <div id="mastA" class="chip"><span class="dot a"></span><span id="mastATxt">Team A</span></div>
    <div id="mastB" class="chip"><span class="dot b"></span><span id="mastBTxt">Team B</span></div>
  </div>
</div>

<div class="wrap">
  <div id="errorBox" class="error"></div>

  <div class="card">
    <div class="toolbar">
      <div>
        <label>Season</label>
        <select id="year"></select>
      </div>
      <div>
        <label>Team A</label>
        <select id="teamA"></select>
      </div>
      <div>
        <label>Team B (compare)</label>
        <select id="teamB"></select>
      </div>
      <div>
        <label>Quick search</label>
        <input id="searchTeams" type="search" placeholder="Type to filter teams…" />
      </div>
      <div><button id="swap">Swap A ↔ B</button></div>
    </div>
    <div class="info">Local JSON only: <code>docs/data/team_stats.json</code> and <code>docs/data/cfbrank.json</code>.</div>
  </div>

  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <h3>Offensive Profile (Spider)</h3>
      <div id="offRadar" class="svgbox"></div>
      <div class="who" style="margin-top:8px"><span class="dot a"></span><span id="legendA1">Team A</span>&nbsp;&nbsp;<span class="dot b"></span><span id="legendB1">Team B</span></div>
    </div>
    <div class="card">
      <h3>Defensive Profile (Spider)</h3>
      <div id="defRadar" class="svgbox"></div>
      <div class="who" style="margin-top:8px"><span class="dot a"></span><span id="legendA2">Team A</span>&nbsp;&nbsp;<span class="dot b"></span><span id="legendB2">Team B</span></div>
    </div>
  </div>

  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <h3>Head-to-Head Efficiency (Bars)</h3>
      <div id="barsH2H" class="svgbox"></div>
      <div class="who" style="margin-top:8px"><span class="dot a"></span><span id="legendA3">Team A</span>&nbsp;&nbsp;<span class="dot b"></span><span id="legendB3">Team B</span></div>
    </div>
    <div class="card">
      <h3>Pace & Play Mix (Bars)</h3>
      <div id="barsPace" class="svgbox"></div>
      <div class="who" style="margin-top:8px"><span class="dot a"></span><span id="legendA4">Team A</span>&nbsp;&nbsp;<span class="dot b"></span><span id="legendB4">Team B</span></div>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>Snapshot — Easy-to-read Key Stats</h3>
    <!-- NEW: clearly labeled A/B values per stat -->
    <div id="snap" class="snapgrid"></div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>Full Comparison Table</h3>
    <table id="statTable">
      <thead>
        <tr><th>Stat</th><th id="thA">Team A</th><th id="thB">Team B</th><th>How it’s calculated</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
/* ---------- Local JSON only ---------- */
(function(){
  const PATH_STATS = "data/team_stats.json";
  const PATH_RANKS = "data/cfbrank.json";

  const $ = id => document.getElementById(id);
  const errBox = $("errorBox");
  const showErr = m => { errBox.style.display="block"; errBox.textContent=m; };
  const clearErr = () => { errBox.style.display="none"; errBox.textContent=""; };

  let RAW=[], RANKS={}, YEARS=[], TEAMS_BY_YEAR={}, SELECTED_YEAR=null;

  const unique = a => Array.from(new Set(a));
  const num = v => (typeof v === "number" && isFinite(v)) ? v : null;
  const fmt = (v,d=3) => (v==null||isNaN(v)) ? "—" : Number(v).toFixed(d);
  const pct = v => (v==null||isNaN(v)) ? "—" : (v*100).toFixed(1)+"%";
  const secToClock = s => (s==null||!isFinite(s)) ? "—" : new Date(s*1000).toISOString().substr(11,8);
  const get = (s,k)=> num(s?.simple?.[k]);

  function games(s){ return get(s,"overall__games") || 0; }
  function totalYds(s){ return get(s,"overall__totalyards") ?? ((get(s,"overall__netpassingyards")||0)+(get(s,"overall__rushingyards")||0)); }
  function oppTotalYds(s){ return get(s,"overall__totalyardsopponent") ?? ((get(s,"overall__netpassingyardsopponent")||0)+(get(s,"overall__rushingyardsopponent")||0)); }
  function perGame(v,s){ const g=games(s); return (v!=null && g>0) ? v/g : null; }
  function playsOff(s){ return num(s?.advanced?.offense?.plays) ?? ((get(s,"overall__passattempts")||0)+(get(s,"overall__rushingattempts")||0)); }
  function playsDef(s){ return num(s?.advanced?.defense?.plays) ?? ((get(s,"overall__passattemptsopponent")||0)+(get(s,"overall__rushingattemptsopponent")||0)); }

  const offPPA = s => num(s?.advanced?.offense?.ppa);
  const offSR  = s => num(s?.advanced?.offense?.successRate);
  const offEX  = s => num(s?.advanced?.offense?.explosiveness);
  const defPPA = s => num(s?.advanced?.defense?.ppa);
  const defSR  = s => num(s?.advanced?.defense?.successRate);
  const defEX  = s => num(s?.advanced?.defense?.explosiveness);
  const offYPP = s => { const p=playsOff(s), y=totalYds(s); return (p && y!=null) ? y/p : null; };
  const defYPP = s => { const p=playsDef(s), y=oppTotalYds(s); return (p && y!=null) ? y/p : null; };

  const passAtt      = s => get(s,"overall__passattempts");
  const rushAtt      = s => get(s,"overall__rushingattempts");
  const oppPassAtt   = s => get(s,"overall__passattemptsopponent");
  const sacksDef     = s => get(s,"overall__sacks");
  const sacksAllowed = s => get(s,"overall__sacksopponent");
  const offSackRate  = s => { const att=passAtt(s); return (att && sacksAllowed(s)!=null) ? sacksAllowed(s)/att : null; };
  const defSackRate  = s => { const att=oppPassAtt(s); return (att && sacksDef(s)!=null) ? sacksDef(s)/att : null; };
  const thirdConv    = s => get(s,"overall__thirddownconversions");
  const thirdDowns   = s => get(s,"overall__thirddowns");
  const thirdRate    = s => (thirdConv(s)!=null && thirdDowns(s)>0) ? thirdConv/thirdDowns : null;
  const oppThirdConv = s => get(s,"overall__thirddownconversionsopponent");
  const oppThirdDowns= s => get(s,"overall__thirddownsopponent");
  const oppThirdRate = s => (oppThirdConv(s)!=null && oppThirdDowns(s)>0) ? oppThirdConv/oppThirdDowns : null;

  function prefixedName(team){
    const rk = (RANKS?.teams||{})[team];
    return rk ? `#${rk} ${team}` : team;
  }

  async function loadAll(){
    const [statsRes, ranksRes] = await Promise.all([
      fetch(PATH_STATS, {cache:"no-store"}),
      fetch(PATH_RANKS, {cache:"no-store"})
    ]);
    if(!statsRes.ok) throw new Error(`Failed to fetch ${PATH_STATS}: ${statsRes.status}`);
    if(!ranksRes.ok) throw new Error(`Failed to fetch ${PATH_RANKS}: ${ranksRes.status}`);
    RAW   = await statsRes.json();
    RANKS = await ranksRes.json();
    YEARS = unique(RAW.map(r=>r.year)).sort((a,b)=>b-a);
    TEAMS_BY_YEAR = {};
    for(const r of RAW){ (TEAMS_BY_YEAR[r.year] ||= []).push(r.team); }
    for(const y of Object.keys(TEAMS_BY_YEAR)){ TEAMS_BY_YEAR[y] = unique(TEAMS_BY_YEAR[y]).sort((a,b)=>a.localeCompare(b)); }
  }

  function populateYearSelect(){
    $("year").innerHTML = YEARS.map(y=>`<option value="${y}">${y}</option>`).join("");
    const prefer = RANKS?.season && YEARS.includes(RANKS.season) ? RANKS.season : YEARS[0];
    $("year").value = prefer;
  }
  function populateTeamSelects(){
    const yr = Number($("year").value);
    const teams = TEAMS_BY_YEAR[yr] || [];
    const opts = teams.map(t=>`<option value="${t}">${prefixedName(t)}</option>`).join("");
    $("teamA").innerHTML = opts;
    $("teamB").innerHTML = opts;
    if(teams.length){ $("teamA").value = teams[0]; $("teamB").value = teams[Math.min(1, teams.length-1)]; }
  }

  function filterTeams(q){
    const yr = Number($("year").value);
    const teams = (TEAMS_BY_YEAR[yr] || []);
    const f = q.trim().toLowerCase();
    const list = f ? teams.filter(t=>t.toLowerCase().includes(f)) : teams.slice();
    const opts = list.map(t=>`<option value="${t}">${prefixedName(t)}</option>`).join("");
    $("teamA").innerHTML = opts; $("teamB").innerHTML = opts;
  }

  const findTeam = (year,name)=> RAW.find(r=>r.year===Number(year)&&r.team===name) || null;

  /* ---------- SVG helpers ---------- */
  function el(name, attrs={}, children=[]){
    const n=document.createElementNS("http://www.w3.org/2000/svg",name);
    Object.entries(attrs).forEach(([k,v])=> n.setAttribute(k,v));
    children.forEach(c=> n.appendChild(c));
    return n;
  }
  function clear(node){ while(node.firstChild) node.removeChild(node.firstChild); }
  function barChartDual(node, labels, A, B){
    clear(node);
    const w=node.clientWidth||640, h=node.clientHeight||360, pad={l:96,r:24,t:24,b:48};
    const svg=el("svg",{width:w,height:h,viewBox:`0 0 ${w} ${h}`});
    const gw=w-pad.l-pad.r, gh=h-pad.t-pad.b;
    const max=Math.max(0.001, ...A.map(v=>Math.abs(v||0)), ...B.map(v=>Math.abs(v||0)));
    svg.appendChild(el("rect",{x:pad.l,y:pad.t,width:gw,height:gh,fill:"none",stroke:"#223045"}));
    const band=gw/labels.length, bw=band*0.36;
    labels.forEach((lab,i)=>{
      const x=pad.l+band*i;
      const vA=A[i]??0, vB=B[i]??0;
      const hA=(Math.abs(vA)/max)*(gh*0.9), hB=(Math.abs(vB)/max)*(gh*0.9);
      const yA=pad.t+gh-hA, yB=pad.t+gh-hB;
      svg.appendChild(el("rect",{x:x+band*0.5-bw-3,y:yA,width:bw,height:hA,fill:"var(--brand)",rx:"4"}));
      svg.appendChild(el("rect",{x:x+band*0.5+3,y:yB,width:bw,height:hB,fill:"var(--accent)",rx:"4"}));
      svg.appendChild(el("text",{x:x+band*0.5,y:pad.t+gh+18,fill:"#a9b4c2","text-anchor":"middle","font-size":"11"},[document.createTextNode(lab)]));
    });
    node.appendChild(svg);
  }
  function radarDual(node, labels, valsA, valsB, colorA="var(--brand)", colorB="var(--accent)"){
    clear(node);
    const w=node.clientWidth||640,h=node.clientHeight||360,cx=w/2,cy=h/2,r=Math.min(w,h)/2-28,rings=4;
    const svg=el("svg",{width:w,height:h,viewBox:`0 0 ${w} ${h}`});
    for(let k=1;k<=rings;k++){
      const rr=(r/rings)*k, pts=[];
      for(let i=0;i<labels.length;i++){
        const a=(Math.PI*2/labels.length)*i - Math.PI/2;
        pts.push(`${cx+rr*Math.cos(a)},${cy+rr*Math.sin(a)}`);
      }
      svg.appendChild(el("polygon",{points:pts.join(" "),fill:"none",stroke:"#223045"}));
    }
    for(let i=0;i<labels.length;i++){
      const a=(Math.PI*2/labels.length)*i - Math.PI/2;
      svg.appendChild(el("line",{x1:cx,y1:cy,x2:cx+r*Math.cos(a),y2:cy+r*Math.sin(a),stroke:"#223045"}));
      const lx=cx+(r+14)*Math.cos(a), ly=cy+(r+14)*Math.sin(a);
      svg.appendChild(el("text",{x:lx,y:ly,fill:"#a9b4c2","font-size":"11","text-anchor": Math.cos(a)>0.1?"start":(Math.cos(a)<-0.1?"end":"middle"),"dominant-baseline":"middle"},[document.createTextNode(labels[i])]));
    }
    function poly(vals,color){
      const pts=vals.map((v,i)=>{ const a=(Math.PI*2/vals.length)*i - Math.PI/2; const rr=r*Math.max(0,Math.min(1,v)); return `${cx+rr*Math.cos(a)},${cy+rr*Math.sin(a)}`; }).join(" ");
      svg.appendChild(el("polygon",{points:pts,fill:color+"30",stroke:color,"stroke-width":"2"}));
    }
    poly(valsA,colorA); poly(valsB,colorB);
    node.appendChild(svg);
  }

  /* ---------- Metrics ---------- */
  const METRICS = [
    ["Points per Play (Offense)",     s => offPPA(s),                     "From advanced metrics (PPA). Higher is better."],
    ["Yards per Play (Offense)",      s => offYPP(s),                     "Total yards divided by offensive plays. Higher is better."],
    ["Success Rate (Offense)",        s => offSR(s),                      "Share of plays that keep the drive on schedule. Higher is better."],
    ["Explosiveness (Offense)",       s => offEX(s),                      "How big the gains are when a play hits. Higher is better."],
    ["Points per Play Allowed",       s => defPPA(s),                     "Points allowed per play. Lower is better."],
    ["Yards per Play Allowed",        s => defYPP(s),                     "Opponents’ yards per defensive play. Lower is better."],
    ["Success Rate Allowed",          s => defSR(s),                      "Opponents’ on-schedule rate. Lower is better."],
    ["Explosiveness Allowed",         s => defEX(s),                      "Opponents’ gain size on hits. Lower is better."],
    ["Plays per Game (Offense)",      s => perGame(playsOff(s), s),       "Offensive plays / game (pace)."],
    ["Pass Rate (share of plays)",    s => { const pa=passAtt(s), ra=rushAtt(s); return (pa!=null&&ra!=null&&pa+ra>0)? pa/(pa+ra): null; }, "Pass attempts as share of plays."],
    ["Rush Rate (share of plays)",    s => { const pa=passAtt(s), ra=rushAtt(s); return (pa!=null&&ra!=null&&pa+ra>0)? ra/(pa+ra): null; }, "Rush attempts as share of plays."],
    ["Total Yards per Game",          s => perGame(totalYds(s), s),       "Team total yards / game."],
    ["Opponent Yards per Game",       s => perGame(oppTotalYds(s), s),    "Opponents’ total yards / game."],
    ["First Downs per Game",          s => perGame(get(s,"overall__firstdowns"), s), "First downs / game."],
    ["Turnover Margin per Game",      s => { const to=get(s,"overall__turnovers"); const ta=get(s,"overall__turnoversopponent"); const g=games(s); return (to!=null&&ta!=null&&g>0)? (ta-to)/g : null; }, "(Takeaways − giveaways) / game. Higher is better."],
    ["Time of Possession per Game",   s => perGame(get(s,"overall__possessiontime"), s), "Seconds with the ball / game."]
  ];

  const preferHigh = name => !["Allowed","Sack Rate","Penalties","Penalty Yards","Opponent"].some(k=>name.includes(k));
  const advantageClass = (name, a, b)=>{
    if(a==null || b==null) return "";
    const highWins = preferHigh(name);
    if(highWins){ return a>b ? "advA" : (b>a ? "advB" : ""); }
    else{        return a<b ? "advA" : (b<a ? "advB" : ""); }
  };

  function computeMaxima(dataset){
    return dataset.reduce((m,s)=>{
      const oy = offYPP(s) || 0, dy = defYPP(s) || 0;
      m.opp = Math.max(m.opp, offPPA(s)||0);
      m.osr = Math.max(m.osr, offSR(s)||0);
      m.oex = Math.max(m.oex, offEX(s)||0);
      m.oyp = Math.max(m.oyp, oy);
      m.dpp = Math.max(m.dpp, defPPA(s)||0);
      m.dsr = Math.max(m.dsr, defSR(s)||0);
      m.dex = Math.max(m.dex, defEX(s)||0);
      m.dyp = Math.max(m.dyp, dy);
      return m;
    },{opp:0,osr:0,oex:0,oyp:0,dpp:0,dsr:0,dex:0,dyp:0});
  }
  const norm = (v,max) => Math.min(1,(v||0)/(max||1));

  function updateMast(year, Aname, Bname){
    $("mastYearTxt").textContent = String(year);
    $("mastATxt").textContent = Aname;
    $("mastBTxt").textContent = Bname;
    // chart legends & table headers
    ["legendA1","legendA2","legendA3","legendA4"].forEach(id=>$(id).textContent=Aname);
    ["legendB1","legendB2","legendB3","legendB4"].forEach(id=>$(id).textContent=Bname);
    $("thA").textContent = Aname;
    $("thB").textContent = Bname;
  }

  function renderAll(){
    clearErr();
    const year = Number($("year").value);
    const Aname = $("teamA").value;
    const Bname = $("teamB").value;
    const A = findTeam(year, Aname);
    const B = findTeam(year, Bname);
    if(!A || !B){ showErr("Selected teams not found in JSON for that season."); return; }

    updateMast(year, prefixedName(Aname), prefixedName(Bname));

    const pool = RAW.filter(r=>r.year===year);
    const MAX = computeMaxima(pool);

    const AoffRaw = [offPPA(A), offSR(A), offEX(A), offYPP(A)];
    const BoffRaw = [offPPA(B), offSR(B), offEX(B), offYPP(B)];
    const Aoff = [norm(AoffRaw[0],MAX.opp), norm(AoffRaw[1],MAX.osr), norm(AoffRaw[2],MAX.oex), norm(AoffRaw[3],MAX.oyp)];
    const Boff = [norm(BoffRaw[0],MAX.opp), norm(BoffRaw[1],MAX.osr), norm(BoffRaw[2],MAX.oex), norm(BoffRaw[3],MAX.oyp)];
    radarDual($("offRadar"), ["Points/Play","Success","Explosiveness","Yards/Play"], Aoff, Boff);

    const AdefRaw = [defPPA(A), defSR(A), defEX(A), defYPP(A)];
    const BdefRaw = [defPPA(B), defSR(B), defEX(B), defYPP(B)];
    const Adef = [norm(AdefRaw[0],MAX.dpp), norm(AdefRaw[1],MAX.dsr), norm(AdefRaw[2],MAX.dex), norm(AdefRaw[3],MAX.dyp)];
    const Bdef = [norm(BdefRaw[0],MAX.dpp), norm(BdefRaw[1],MAX.dsr), norm(BdefRaw[2],MAX.dex), norm(BdefRaw[3],MAX.dyp)];
    radarDual($("defRadar"), ["Pts/Play Allowed","Success Allowed","Explosive Allowed","Yds/Play Allowed"], Adef, Bdef);

    const labels1 = ["Pts/Play (Off)","Pts/Play Allowed","Success (Off)","Success Allowed","Yds/Play (Off)","Yds/Play Allowed"];
    barChartDual($("barsH2H"), labels1,
      [AoffRaw[0]||0, AdefRaw[0]||0, AoffRaw[1]||0, AdefRaw[1]||0, AoffRaw[3]||0, AdefRaw[3]||0],
      [BoffRaw[0]||0, BdefRaw[0]||0, BoffRaw[1]||0, BdefRaw[1]||0, BoffRaw[3]||0, BdefRaw[3]||0]
    );

    const Apg = perGame(playsOff(A),A) || 0, Bpg = perGame(playsOff(B),B) || 0;
    const ApassShare = (()=>{const pa=passAtt(A), ra=rushAtt(A); return (pa!=null&&ra!=null&&(pa+ra)>0)? pa/(pa+ra):0;})();
    const BpassShare = (()=>{const pa=passAtt(B), ra=rushAtt(B); return (pa!=null&&ra!=null&&(pa+ra)>0)? pa/(pa+ra):0;})();
    barChartDual($("barsPace"), ["Plays/Game","Pass Rate"], [Apg,ApassShare], [Bpg,BpassShare]);

    // ----- Snapshot with clear labels for A & B -----
    const snapNames = [
      "Points per Play (Offense)","Yards per Play (Offense)","Success Rate (Offense)","Explosiveness (Offense)",
      "Points per Play Allowed","Yards per Play Allowed","Success Rate Allowed","Explosiveness Allowed",
      "Plays per Game (Offense)","Pass Rate (share of plays)","Rush Rate (share of plays)",
      "Total Yards per Game","Opponent Yards per Game","First Downs per Game","Turnover Margin per Game","Time of Possession per Game"
    ];
    const snap = $("snap"); snap.innerHTML="";
    const isPctName = n => /Rate|share/i.test(n);
    const isClock = n => /Time of Possession/i.test(n);

    for(const name of snapNames){
      const getter = METRICS.find(m=>m[0]===name)?.[1];
      const Av = getter? getter(A) : null;
      const Bv = getter? getter(B) : null;
      const Atext = isPctName(name) ? pct(Av) : (isClock(name) ? secToClock(Av) : fmt(Av, name.includes("Yards")?2:3));
      const Btext = isPctName(name) ? pct(Bv) : (isClock(name) ? secToClock(Bv) : fmt(Bv, name.includes("Yards")?2:3));
      const adv = advantageClass(name, Av, Bv);
      const div=document.createElement("div"); div.className="stat";
      div.innerHTML = `
        <label>${name}</label>
        <div class="pair">
          <div class="val ${Av==null?'fade':''}">
            <div class="who"><span class="dot a"></span><span>${prefixedName(Aname)}</span></div>
            <div class="v ${adv==='advA'?'advA':''}">${Atext}</div>
          </div>
          <div class="val ${Bv==null?'fade':''}">
            <div class="who"><span class="dot b"></span><span>${prefixedName(Bname)}</span></div>
            <div class="v ${adv==='advB'?'advB':''}">${Btext}</div>
          </div>
        </div>`;
      snap.appendChild(div);
    }

    // ----- Full table remains, but headers are named -----
    const tbody = $("statTable").querySelector("tbody");
    tbody.innerHTML="";
    for(const [name,getter,desc] of METRICS){
      const Av = getter(A), Bv = getter(B);
      const Avs = (/Rate|share/i.test(name)) ? pct(Av) : (/Time of Possession/i.test(name) ? secToClock(Av) : fmt(Av, name.includes("Yards")?2:3));
      const Bvs = (/Rate|share/i.test(name)) ? pct(Bv) : (/Time of Possession/i.test(name) ? secToClock(Bv) : fmt(Bv, name.includes("Yards")?2:3));
      const advClsA = advantageClass(name, Av, Bv)==="advA" ? "advA" : "";
      const advClsB = advantageClass(name, Av, Bv)==="advB" ? "advB" : "";
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${name}</td>
        <td class="${(Av==null?'fade ':'')+advClsA}">${Avs}</td>
        <td class="${(Bv==null?'fade ':'')+advClsB}">${Bvs}</td>
        <td class="fade">${desc}</td>`;
      tbody.appendChild(tr);
    }
  }

  // events
  $("year").addEventListener("change", ()=>{ populateTeamSelects(); renderAll(); });
  $("teamA").addEventListener("change", renderAll);
  $("teamB").addEventListener("change", renderAll);
  $("swap").addEventListener("click", ()=>{
    const a=$("teamA").value, b=$("teamB").value;
    $("teamA").value=b; $("teamB").value=a; renderAll();
  });
  $("searchTeams").addEventListener("input", e=> filterTeams(e.target.value));

  (async function init(){
    try{
      await loadAll();
      populateYearSelect();
      populateTeamSelects();
      renderAll();
    }catch(e){
      showErr(e.message+"\n\nEnsure files exist:\n- docs/data/team_stats.json\n- docs/data/cfbrank.json");
    }
  })();
})();
</script>
</body>
</html>